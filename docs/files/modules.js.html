<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>modules.js - MODJS</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="MODJS"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/MOD.app.html">MOD.app</a></li>
            
                <li><a href="../classes/MOD.app.return.html">MOD.app.return</a></li>
            
                <li><a href="../classes/MOD.core.html">MOD.core</a></li>
            
                <li><a href="../classes/MOD.core.dom.html">MOD.core.dom</a></li>
            
                <li><a href="../classes/MOD.core.dom.form.html">MOD.core.dom.form</a></li>
            
                <li><a href="../classes/MOD.core.return.html">MOD.core.return</a></li>
            
                <li><a href="../classes/MOD.core.util.html">MOD.core.util</a></li>
            
                <li><a href="../classes/MOD.sandbox.html">MOD.sandbox</a></li>
            
                <li><a href="../classes/MOD.sandbox.return.html">MOD.sandbox.return</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/MOD.html">MOD</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: modules.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

/**
 * All modules for the application are stored in this file
 * A module is a small piece of the application that is responsible for a minute
 * amount of tasks
 */


/**
 * instagram-search-settings
 * responsible for sending notifications when a search is requested
 *
 * @param  {object} sb a copy of the sandbox to interact with the core
 * @return {none}
 */
MOD.core.create_module( &#x27;instagram-search&#x27;, function( sb ) {
	var btn, input, loader, cache = {}, interval;

	return {
		init : function () {
			btn = sb.find( &#x27;.instagram-search-submit&#x27; )[ 0 ],
			input = sb.find( &#x27;.instagram-search-term&#x27; )[ 0 ],
			loader = sb.find( &#x27;.ajax-loader&#x27; )[ 0 ];

			sb.add_event( btn, &#x27;click&#x27;, this.search );

			// clear cache every 10 min
			interval = setInterval(function () {
				cache = {};
			}, 60*10*1000 );
		},

		destroy : function () {
			sb.remove_event( btn, &#x27;click&#x27;, this.search );
			btn = input = loader = null, cache = {};
			clearInterval( interval );
		},

		search : function ( e ) {

			//get our vars, set a default for the search term
			var term = sb.get_value( input ) || &#x27;MODafy&#x27;,
				instagramURL;
				access_token = &#x27;22033045.ea9028a.eec94286a2e049429fe51c3fbc95db20&#x27;;

			// set the loader to active
			sb.modify( loader, &#x27;add-class&#x27;, &#x27;active&#x27; );

			// check the cache for the search term
			if ( cache &amp;&amp; cache[ term ] ) {

				// let the core know we have a notification to broadcast
				sb.notify({
					type : &#x27;instagram-search-results-returned&#x27;,
					data : cache[ term ]
				});

				// update the loader
				sb.modify( loader, &#x27;remove-class&#x27;, &#x27;active&#x27; );
			} else {

				// build our request URL
				instagramURL = &#x27;https://api.instagram.com/v1/tags/&#x27; + term + &#x27;/media/recent?callback=?&amp;count=10&amp;access_token=&#x27; + access_token;

				sb.request({
					url : instagramURL,
					type : &#x27;GET&#x27;,
					dataType : &#x27;JSON&#x27;,
					done : function ( response ) {

						// cache the request for ten minutes
						cache[ term ] = response.data;

						// let the core know we have a notification to announce
						sb.notify({
							type : &#x27;instagram-search-results-returned&#x27;,
							data : response.data
						});

						// update the loader
						sb.modify( loader, &#x27;remove-class&#x27;, &#x27;active&#x27; );
					},
					fail : function ( error ) {

						// TODO: add a better system for this, I will prolly run function again
						alert( error.message );
						sb.modify( loader, &#x27;remove-class&#x27;, &#x27;active&#x27; );
					},
					scope : this
				});
			}
		}
	}
});


/**
 * instagram feed
 * responsible for building the feed when a search is requested
 *
 * @param  {object} sb a copy of the sandbox to interact with the core
 * @return {none}
 */
MOD.core.create_module( &#x27;instagram-feed&#x27;, function( sb ) {
	var container, template, loader, root = this;

	return {
		init : function () {
			container = sb.find( &#x27;.instagram-post-container&#x27; )[ 0 ],
			template = sb.find( &#x27;#instagram-post-template&#x27; )[ 0 ].innerHTML,
			loader = sb.find( &#x27;.ajax-loader&#x27; );

			sb.listen({
				&#x27;instagram-search-results-returned&#x27; : this.build
			});
		},

		destroy : function () {
			sb.ignore( [ &#x27;instagram-search-results-returned&#x27; ], &#x27;instagram-feed&#x27; );
			container = template = loader = null;
		},

		build : function ( data ) {
			var i = 0, html = &#x27;&#x27;;

			// remove any previous results or messages
			sb.remove( container, &#x27;li, p&#x27; );

			// sanity check for data
			if ( data ) {

				// loop the data and build our html from the template within the module
				while ( data[ i ] ) {

					// right now we are only handling images
					if ( data[ i ].type === &#x27;image&#x27; ) {

						html += template.replace( /{{link}}/, data[ i ].images.standard_resolution.url )
									.replace( /{{profile_picture}}/, data[ i ].user.profile_picture )
									.replace( /{{username}}/, data[ i ].user.username )
									.replace( /{{tags}}/, data[ i ].tags.join( &#x27;, &#x27; ) )
									.replace( /{{likes}}/, data[ i ].likes.count );
					}
					++i;
				}
			} else {

				// if data is empty then there are no results, so let the user know
				html = sb.create_element({
					el : &#x27;p&#x27;,
					text : &#x27;Sorry, no results for that search term... =[&#x27;,
					attrs : {
						&#x27;class&#x27; : &#x27;instagram-feed-no-results&#x27;
					}
				});
			}

			// add the instagram posts or message
			sb.append( container, html );
		}
	}
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
