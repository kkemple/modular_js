/* ModJS
 * 2013-10-23
 * Author: Kurtis Kemple
 * Email: kurtiskemple@gmail.com
 * URL: http://kurtiskemple.com
 */
var MOD={};MOD.core=function(){function a(a){function b(a,c,d){var e,f=a.currentStyle[c].match(/([\d\.]+)(%|cm|em|in|mm|pc|pt|)/)||[0,0,""],g=f[1],h=f[2];return d=null!=d?d:/%|em/.test(h)&&a.parentElement?b(a.parentElement,"fontSize",null):16,e="fontSize"==c?d:/width/i.test(c)?a.clientWidth:a.clientHeight,"%"===h?g/100*e:"cm"===h?96*.3937*g:"em"===h?g*d:"in"===h?96*g:"mm"===h?96*.3937*g/10:"pc"===h?96*12*g/72:"pt"===h?96*g/72:g}function c(a,b){var c="border"==b?"Width":"",d=b+"Top"+c,e=b+"Right"+c,f=b+"Bottom"+c,g=b+"Left"+c;a[b]=(a[d]==a[e]&&a[d]==a[f]&&a[d]==a[g]?[a[d]]:a[d]==a[f]&&a[g]==a[e]?[a[d],a[e]]:a[g]==a[e]?[a[d],a[e],a[f]]:[a[d],a[e],a[f],a[g]]).join(" ")}function d(a){var d=this,f=a.currentStyle,g=b(a,"fontSize");for(property in f)e.call(d,"styleFloat"==property?"float":property.replace(/[A-Z]/,function(a){return"-"+a.toLowerCase()})),"width"===property?d[property]=a.offsetWidth+"px":"height"===property?d[property]=a.offsetHeight+"px":"styleFloat"===property?d["float"]=f[property]:d[property]=/margin.|padding.|border.+W/.test(property)&&"auto"!=d[property]?Math.round(b(a,property,g))+"px":f[property];c(d,"margin"),c(d,"padding"),c(d,"border"),d.fontSize=Math.round(g)+"px"}var e=Array.prototype.push;return d.prototype={constructor:d,getPropertyPriority:function(){throw Error("NotSupportedError: DOM Exception 9")},getPropertyValue:function(a){if(void 0===a)throw Error("TypeError: Not enough arguments to CSSStyleDeclaration.getPropertyValue");return a=a.replace(/-\w/g,function(a){return a[1].toUpperCase()}),"function"==typeof this[a]||a.match(/^(?:cssText|length|\d+)$/)?"":this[a]},item:function(a){if(void 0===property)throw Error("TypeError: Not enough arguments to CSSStyleDeclaration.item");return this[parseInt(a,10)]},removeProperty:function(){throw Error("NoModificationAllowedError: DOM Exception 7")},setProperty:function(){throw Error("NoModificationAllowedError: DOM Exception 7")},getPropertyCSSValue:function(){throw Error("NotSupportedError: DOM Exception 9")}},new d(a)}var b={},c=this;return this.util={debug:!0,log:function(a,b){this.debug&&console[1===a?"log":2===a?"warn":"error"](b)},to_string:function(a){return a.toString()},trim:function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},to_camel_case:function(a,b){var c;switch(b){case" ":b="\\s";break;default:b="-"}return c=new RegExp(b+"([a-z])","gi"),a.replace(c,function(a,b){return b.toUpperCase()})},is_object:function(a){return"object"==typeof a&&"[object Object]"===Object.prototype.toString.call(a)?!0:!1},is_array:function(a){return"object"==typeof a&&"[object Array]"===Object.prototype.toString.call(a)?!0:!1},array_contains:function(a,b){var c=0,d=a.length;if("object"!=typeof a&&"[object Array]"!==Object.prototype.toString.call(a))return this.log(1,'ARRAY : CONTAINS : FAILED : "Array argument is of wrong type"'),void 0;for(;d>c;){if(a[c]===b)return!0;++c}return!1},map:function(a,b,c){var d=[],e=0;if(c=c?c:null,"function"==typeof b){for(;a[e];)d.push(b.call(c,a[e],e)),++e;return d}this.log(1,'UTIL : MAP : FAILED : "One or more arguments are of wrong type"')},ajax:function(a){if(a&&a.url&&a.scope&&a.done&&a.fail){var b=jQuery.ajax({url:a.url,data:a.data,type:a.type?a.type:"GET",dataType:a.dataType?a.dataType:"JSON"});b.done(function(b){a.done.call(a.scope,b)}),b.fail(function(b,c){var d={message:c,XHR:b};a.fail.call(a.scope,d)})}else this.log(1,'AJAX : FAILED : "Incomplete config for request, see docs for full config example"')},isIE:function(a,b){function c(){var a=-1,c=b,d=new RegExp(/MSIE ([0-9]{1,}[\.0-9]{0,})/);return null!==d.exec(c)&&(a=parseFloat(RegExp.$1)),a}var d=!1,e=c();return e>-1&&(a&&a>=e||!a)&&(d=!0),d}},this.dom={query:function(a,b){var d,e={};return d=b&&b.find?b.find(a):jQuery(a),e=d.get(),e.length=d.length,e.query=function(a){return c.dom.query(a,d)},e},bind:function(a,b,d){a&&"string"==typeof b?jQuery(a).on(b,d):c.util.log(2,'Event "'+b+'" : Attachment : FAILED : "Event attachment to element: '+a+' failed."')},unbind:function(a,b,d){a&&"string"==typeof b?jQuery(a).off(b,d):c.util.log(2,'Event "'+b+'" : Removal : FAILED : "Event removal on element: '+a+' failed."')},create:function(a){var b,d,e,f;if(!a||!a.el)return c.util.log(1,'CREATE : ELEMENT : FAILED : "Incorrect configuration for element creation"'),!1;if(e=document.createElement(a.el),a.text&&e.appendChild(document.createTextNode(a.text)),a.attrs&&(c.util.is_object(a.attrs)?c.dom.apply_attrs(e,a.attrs):c.log(1,'CREATE : ELEMENT : FAILED : "config.attrs is of wrong type')),a.children)if(c.util.is_array(a.children))for(b=0,d=a.children.length;d>b;)f=c.dom.create(a.children[b]),a.children[b].attrs&&c.dom.apply_attrs(f,a.children[b].attrs),e.appendChild(f),++b;else c.util.log(1,'CREATE : ELEMENT : FAILED : "config.children is of wrong type"');return delete a,e},apply_attrs:function(a,b){if(c.util.is_object(b))for(var d in b)b.hasOwnProperty(d)&&a.setAttribute(d,b[d]);else c.util.log(1,'APPLY ATTRIBUTES : FAILED : "Attributes argument is of wrong type."')},prop:function(a,b,c){return void 0===c?a.getAttribute(b):(a.setAttribute(b,c),void 0)},offset:function(a){var b=function(){return null!==window.pageXOffset?{x:window.pageXOffset,y:window.pageYOffset}:{x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop}}(),c=a.getBoundingClientRect();return{x:Math.floor(c.left+b.x),y:Math.floor(c.top+b.y)}},style:function(b,d,e){var f,g;if("object"==typeof d){for(g in d)d.hasOwnProperty(g)&&(f=c.util.to_camel_case(g),b.style[f]=d[g]);return null}return"string"==typeof d&&void 0===e?(compStyle=window.getComputedStyle?window.getComputedStyle(b):a(b),compStyle.getPropertyValue(d)):"string"==typeof d&&"string"==typeof e?(b.style[c.util.to_camel_case(d)]=e,null):(c.util.log(1,'STYLE : FAILED : "One or more arguments are of wrong type"'),void 0)},add_class:function(a,b){for(var d=b.split(/\s+/),e=" "+a.className+" ",f=e.split(/\s+/),g=d.length,h=0;g>h;)c.util.array_contains(f,d[h])||(e=e+" "+d[h]),++h;a.className=c.util.trim(e)},remove_class:function(a,b){for(var d=b.split(/\s+/),e=" "+a.className+" ",f=d.length,g=0;f>g;)e=e.replace(" "+d[g]+" "," "),++g;a.className=c.util.trim(e)},has_class:function(a,b){var d=a.className,e=d.split(/\s+/);return c.util.array_contains(e,b)?!0:!1},append_elems:function(a,b){"string"==typeof b?a.innerHTML=a.innerHTML+b:a.appendChild(b)},prepend_elems:function(a,b){"string"==typeof b?a.innerHTML=b+a.innerHTML:a.insertBefore(b,a.firstChild)},next_element:function(a){var b;return b=a.nextSibling,null===b?null:b.nodeType>1?this.next_element(b):"script"===b.tagName.toLowerCase()?this.next_element(b):"style"===b.tagName.toLowerCase()?this.next_element(b):b},previous_element:function(a){var b;return b=a.previousSibling,null===b?null:b.nodeType>1?this.previous_element(b):"script"===b.tagName.toLowerCase()?this.previous_element(b):"style"===b.tagName.toLowerCase()?this.previous_element(b):b},onready:function(a){jQuery(document).ready(function(){a.call()})},onload:function(a){jQuery("window").on("load",function(){a.call()})}},{util:this.util,dom:this.dom,create_module:function(a,d){var e;return"string"==typeof a&&"function"==typeof d?(e=d(MOD.sandbox.create(this,a)),e.init&&e.destroy&&"function"==typeof e.init&&"function"==typeof e.destroy?(e=null,b[a]={create:d,instance:null,evts:null},!0):(c.util.log(1,'Module : "'+a+'"" : Registration : FAILED : "Instance has either no init or no destroy method"'),!1)):(c.util.log(1,'Module : "'+c.util.to_string(a)+'"" : Registration : FAILED : "One or more arguments are of wrong type"'),!1)},start:function(a){var d=b[a];return d?(d.instance=d.create(MOD.sandbox.create(this,a)),d.instance.init(),!0):(c.util.log(1,'Module : "'+a+'"" : Stop : FAILED : "No module by that ID"'),!1)},start_all:function(){var a;for(a in b)if(b.hasOwnProperty(a)&&!this.start(a))return!1;return!0},stop:function(a){var d=b[a];return d.instance?(d.instance.destroy(),d.instance=null,!0):(c.util.log(1,'Module : "'+a+'"" : Stop : FAILED : "No module by that ID or no running module by that ID"'),!1)},stop_all:function(){var a;for(var a in b)if(b.hasOwnProperty(a)&&!this.stop(a))return!1;return!0},register_events:function(a,d){if(this.util.is_object(a)&&d){var e=b[d];return e?(e.evts=a,!0):(c.util.log(1,'Module : "'+d+'"" : Register Events : FAILED : "No module by that ID"'),!1)}return c.util.log(1,'Module : "'+d+'"" : Register Events : FAILED : "One or more arguments are of wrong type'),!1},trigger_event:function(a){var d;if(this.util.is_object(a)&&a.type){for(d in b)b.hasOwnProperty(d)&&(d=b[d],d.evts&&d.evts[a.type]&&d.evts[a.type](a.data));return!0}return c.util.log(1,'Event : "'+this.util.to_string(a.type)+'"" : Trigger Event : FAILED : "Event object is of wrong type or there is no event type specified"'),!1},remove_events:function(a,d){if(c.util.is_array(a)&&d){var e=b[d];if(e){var f=0;for(a.length;a[f];)e.evts[a[f]]&&delete e.evts[a[f]],++f;return!0}return c.util.log(1,'Module : "'+d+'"" : Remove Events : FAILED : "No module by that ID"'),!1}return c.util.log(1,'Module : "'+d+'"" : Remove Events : FAILED : "One or more arguments are of wrong type"'),!1}}}(),MOD.app=function(){return start_on_ready=function(a){for(var b=a.length,c=0;b>c;)MOD.core.start(a[c]),++c},start_on_load=function(a){for(var b=a.length,c=0;b>c;)MOD.core.start(a[c]),++c},{run:function(){MOD.core.util.debug=MOD.config.debug?MOD.config.debug:!0,MOD.config.onready&&MOD.core.dom.onready(function(){start_on_ready(MOD.config.onready.modules)}),MOD.config.onload&&MOD.core.dom.onload(function(){start_on_load(MOD.config.onload.modules)})}}}(),MOD.sandbox={create:function(a,b){var c=a.dom.query("#"+b);return{find:function(a){return c.query(a)},add_event:function(b,c,d){a.dom.bind(b,c,d)},remove_event:function(b,c,d){a.dom.unbind(b,c,d)},notify:function(b){a.trigger_event(b)},listen:function(c){a.register_events(c,b)},ignore:function(b,c){a.remove_events(b,c)},create_element:function(b){return a.dom.create(b)},append:function(b,c){a.dom.append_elems(b,c)},prepend:function(b,c){a.dom.prepend_elems(b,c)},next:function(b){return a.dom.next_element(b)},prev:function(b){return a.dom.previous_element(b)},request:function(b){a.util.ajax(b)},add_class:function(b,c){a.dom.add_class(b,c)},remove_class:function(b,c){a.dom.remove_class(b,c)},has_class:function(b,c){a.dom.has_class(b,c)},css:function(b,c,d){a.dom.style(b,c,d)},attr:function(b,c,d){a.dom.prop(b,c,d)},offset:function(b){return a.dom.offset(b)},animate:function(b,c,d,e,f){a.dom.animate(b,c,d,e,f)},foreach:function(b,c,d){return a.util.map(b,c,d)}}}},MOD.form=function(a){var b,c,d,e,f,g,h;return f={init:function(a){g=a.elements,b=a.getElementsByClassName("validate")},validate:function(){return d=!1,f.clear_errors(),MOD.core.util.map(b,function(a){c=a,MOD.core.dom.has_class(a,"required")&&f.check.required(a),MOD.core.dom.has_class(a,"email")&&f.check.email(a),MOD.core.dom.has_class(a,"phone")&&f.check.phone(a),MOD.core.dom.has_class(a,"url")&&f.check.url(a),MOD.core.dom.has_class(a,"creditcard")&&f.check.credit_card(a),MOD.core.dom.has_class(a,"minlength")&&f.check.min_length(a),MOD.core.dom.has_class(a,"maxlength")&&f.check.max_length(a),MOD.core.dom.has_class(a,"equalto")&&f.check.equal_to(a)}),d!==!0?!0:!1},set_error:function(b){if(e=a.getElementsByClassName("errors")[0],!e){var d={el:"div",attrs:{"class":"errors"}};e=MOD.core.dom.create(d),a.insertBefore(e,a.firstChild)}MOD.core.dom.add_class(c,"error");var f={el:"p",text:b,attrs:{"class":"error-list-item"}};e.appendChild(MOD.core.dom.create(f))},clear_errors:function(){MOD.core.util.map(b,function(a){MOD.core.dom.remove_class(a,"error")}),e&&(e.innerHTML=null)},prep:function(b){b=b?b:!1,h={};var c,d=[];if(MOD.core.util.map(g,function(b){var c=b.tagName.toLowerCase();switch(c){case"input":var d=b.type;switch(d){case"text":case"email":case"password":case"phone":case"url":h[b.name]=b.value;break;case"checkbox":h[b.name]=b.checked?"1":"0";break;case"radio":var e=!1;MOD.core.util.map(a[b.name],function(a){a.checked&&(h[b.name]=a.value,e=!0)}),e||(h[b.name]="0")}break;case"textarea":h[b.name]=b.value;break;case"select":if(b.multiple)if(-1!==b.selectedIndex){var f=[];MOD.core.util.map(b.options,function(a){a.selected===!0&&f.push(a.value)}),h[b.name]=f}else h[b.name]=[];else h[b.name]=-1!==b.selectedIndex?b.options[b.selectedIndex].value:""}}),!h)return"";if(b){for(c in h)if(h.hasOwnProperty(c)&&"function"!=typeof h){var e=h[c].toString();c=encodeURIComponent(c).replace(/\%20/g,"+"),e=encodeURIComponent(e).replace(/\%20/g,"+"),d.push(c+"="+e)}return d.join("&")}return JSON.stringify(h)},check:{required:function(a){var c=a.tagName.toLowerCase();switch(c){case"input":var e=a.type;switch(e){case"text":case"email":case"password":case"phone":case"url":a.value.length<1&&(d=!0,f.set_error("One or more fields are required."));break;case"checkbox":a.checked===!1&&(d=!0,f.set_error("This field is required."));break;case"radio":var g,h,i=a.name,j=!1,k=[];for(MOD.core.util.map(b,function(a){a.name===i&&k.push(a)}),g=0,h=k.length;h>g;g++)if(k[g].checked===!0)return j=!0,void 0;j||(d=!0,f.set_error("One or more options is required."))}break;case"textarea":a.value.length<1&&(d=!0,f.set_error("One or more fields are required."));break;case"select":-1===a.options.selectedIndex&&(d=!0,f.set_error("One or more options are required."))}},email:function(a){var b=a.value;arr=b.match(/^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/),null===arr&&(d=!0,f.set_error("Not a valid email address."))},phone:function(a){var b=a.value,c=b.match(/^\(+?[0-9]{3}\)+?\s[0-9]{3}[\s|\.|-][0-9]{4}|^[0-9]{3}[\s|\.|\-][0-9]{3}[\s|\.|-][0-9]{4}|^[0-9]{10}$/);null===c&&(d=!0,f.set_error("Not a valid phone number."))},url:function(a){var b=a.value,c=b.match(/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/);null===c&&(d=!0,f.set_error("Not a valid url."))},credit_card:function(a){var b=a.value,c=b.match(/\d{16}/);null===c&&(d=!0,f.set_error("Not a valid credit card number."))},min_length:function(a){var b=a.tagName.toLowerCase(),c=parseInt(a.getAttribute("data-minlength"),10);switch(b){case"input":switch(type=a.type){case"text":case"email":case"password":case"phone":case"url":a.value.length<c&&(d=!0,f.set_error("Minimum length is "+c+"."))}break;case"textarea":a.value.length<c&&(d=!0,f.set_error("Minimum length is "+c+"."));break;case"select":var e=0;if(a.multiple){for(i=0,len=a.options.length;len>i;i++)a.options[i].selected===!0&&++e;c>e&&(d=!0,f.set_error("Minimum length is "+c+"."))}}},max_length:function(a){var b=a.tagName.toLowerCase(),c=parseInt(a.getAttribute("data-maxlength"),10);switch(b){case"input":var e=a.type;switch(e){case"text":case"email":case"password":case"phone":case"url":a.value.length>c&&(d=!0,f.set_error("Maximum length is "+c+"."))}break;case"textarea":a.value.length>c&&(d=!0,f.set_error("Maximum length is "+c+"."));break;case"select":var g,h,i=0;if(a.multiple){for(g=0,h=a.options.length;h>g;g++)a.options[g].selected===!0&&++i;i>c&&(d=!0,f.set_error("Maximum length is "+c+"."))}}},equal_to:function(a){var b=a.tagName.toLowerCase(),c=parseInt(a.getAttribute("data-equalto"),10);switch(b){case"input":var e=a.type;switch(e){case"text":case"email":case"password":case"phone":case"url":a.value.length!==c&&(d=!0,f.set_error("Minimum length is "+c+"."))}break;case"textarea":a.value.length!==c&&(d=!0,f.set_error("Minimum length is "+c+"."));break;case"select":var g,h,i=0;if(a.multiple){for(g=0,h=a.options.length;h>g;g++)a.options[g].selected===!0&&++i;i!==c&&(d=!0,f.set_error("Minimum length is "+c+"."))}}}}},f.init(a),f},MOD.template=function(){var a={};return ret={parse:function(b,c){if(a[b])return c?a[b](c):a[b];var d=document.getElementById(b).innerHTML,e=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+d.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return a[b]=e,c?e(c):e}}}();